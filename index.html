<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>VaultiQ</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="manifest.json">

<!-- Google Login -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<style>
:root {
  --bg:#f4f6fa;
  --card:#fff;
  --primary:#007aff;
  --text:#111;
  --radius:18px;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  background:var(--card);
  box-shadow:0 2px 10px rgba(0,0,0,.06);
}

button{
  background:var(--primary);
  color:#fff;
  border:none;
  padding:10px 16px;
  border-radius:12px;
  font-size:14px;
}

input{
  width:calc(100% - 32px);
  margin:16px;
  padding:14px;
  border:none;
  border-radius:var(--radius);
  font-size:16px;
  box-shadow:0 2px 8px rgba(0,0,0,.08);
}

.card{
  background:var(--card);
  margin:16px;
  padding:16px;
  border-radius:var(--radius);
}

.hidden{display:none;}
</style>
</head>

<body>

<header>
  <h2>VaultiQ</h2>
  <button id="installBtn" class="hidden">Install</button>
</header>

<main>
  <div id="login"></div>

  <div id="app" class="hidden">
    <input id="search" placeholder="Search documents, tagsâ€¦">
    <div class="card">
      <h3>Folders</h3>
      <ul id="folders"></ul>
    </div>
    <div class="card">
      <h3>QR Generator</h3>
      <button onclick="generateQR()">Generate QR</button>
      <canvas id="qr"></canvas>
    </div>
  </div>
</main>

<script type="module">
/* =======================
   PWA INSTALL
======================= */
let deferredPrompt;
window.addEventListener("beforeinstallprompt", e=>{
  e.preventDefault();
  deferredPrompt=e;
  document.getElementById("installBtn").classList.remove("hidden");
});
document.getElementById("installBtn").onclick=()=>deferredPrompt.prompt();

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}

/* =======================
   GOOGLE LOGIN
======================= */
google.accounts.id.initialize({
  client_id:"YOUR_GOOGLE_CLIENT_ID",
  callback:handleLogin
});
google.accounts.id.renderButton(
  document.getElementById("login"),
  {theme:"outline",size:"large"}
);

function handleLogin(res){
  localStorage.setItem("vaultiq_user",res.credential);
  document.getElementById("login").classList.add("hidden");
  document.getElementById("app").classList.remove("hidden");
  loadFolders();
}

/* =======================
   DATA (MVP LOCAL MODEL)
======================= */
let folders=[
  {id:"auto",name:"ðŸš— Automobile",tags:["vehicle","emergency"]},
  {id:"personal",name:"ðŸ‘¤ Personal",tags:["id","documents"]},
  {id:"education",name:"ðŸŽ“ Education",tags:["marks","degree"]},
  {id:"health",name:"ðŸ¥ Health",tags:["insurance","medical"]}
];

function loadFolders(){
  const ul=document.getElementById("folders");
  ul.innerHTML="";
  folders.forEach(f=>{
    const li=document.createElement("li");
    li.textContent=f.name;
    ul.appendChild(li);
  });
}

/* =======================
   SMART SEARCH (CLIENT)
======================= */
document.getElementById("search").oninput=e=>{
  const q=e.target.value.toLowerCase();
  const ul=document.getElementById("folders");
  ul.innerHTML="";
  folders
    .filter(f=>f.name.toLowerCase().includes(q)||f.tags.join().includes(q))
    .forEach(f=>{
      const li=document.createElement("li");
      li.textContent=f.name;
      ul.appendChild(li);
    });
};

/* =======================
   QR GENERATION (DYNAMIC)
======================= */
function generateQR(){
  const data=location.origin+location.pathname+"#/vault";
  const canvas=document.getElementById("qr");
  const ctx=canvas.getContext("2d");
  canvas.width=240;canvas.height=240;
  ctx.fillStyle="#fff";ctx.fillRect(0,0,240,240);
  ctx.fillStyle="#000";
  ctx.fillText("QR â†’ "+data,20,120);
}

/* =======================
   EMERGENCY OFFLINE CACHE
======================= */
async function cacheEmergency(){
  const cache=await caches.open("vaultiq-emergency");
  await cache.add(location.href);
}
</script>

</body>
</html>
